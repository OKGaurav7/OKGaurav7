import pandas as pd
from openpyxl import load_workbook
from openpyxl.styles import PatternFill
from datetime import datetime

def process_excel_file(input_file_path):
    # Read the Excel file
    master_df = pd.read_excel(input_file_path)

    selected_columns = ['Counterparty Name', 'Operation Type', 'Trade Date', 'Trade Price', 'Value Date', 'Primary Original Quantity', 'Settlement Instrument Name', 'ISIN Primary Instrument Reference', 'Primary Instrument Long Name', 'SMO Trade Reference', 'Internal Status Narrative', 'Sales Person Name']
    output_df = master_df[selected_columns]

    # Define new columns
    new_columns = ['CBBT_PX_ASK', 'Economic Impact', 'LQA (Liq Score)', 'Days Elapsed']

    # Insert new columns after "Trade Price"
    output_df = output_df.reindex(columns=output_df.columns.tolist()[:4] + new_columns + output_df.columns.tolist()[4:])

    # Add dummy data to new columns
    import random
    output_df['CBBT_PX_ASK'] = [random.randint(1, 100) for _ in range(len(output_df))]
    output_df['Economic Impact'] = [random.uniform(1000, 10000) for _ in range(len(output_df))]
    output_df['LQA (Liq Score)'] = [random.uniform(1000, 10000) for _ in range(len(output_df))]

    output_df['Trade Date'] = pd.to_datetime(output_df['Trade Date']).dt.strftime('%Y-%m-%d')
    output_df['Value Date'] = pd.to_datetime(output_df['Value Date']).dt.strftime('%Y-%m-%d')

    output_df['Value Date'] = pd.to_datetime(output_df['Value Date'])

    today = datetime.today()
    output_df['Days Elapsed'] = (today - output_df['Value Date']).dt.days - 1

    output_filename = 'output.xlsx'
    output_df.to_excel(output_filename, index=False, sheet_name='Sheet1')

    # Open the Excel file
    wb = load_workbook(output_filename)
    ws = wb.active

    # Set header cells background color to red
    for cell in ws[1]:
        cell.fill = PatternFill(start_color="FF0000", end_color="FF0000", fill_type="solid")

    # Save the modified Excel file
    wb.save(output_filename)

    return output_filename

# Define the file path
file_path = r'Z:\Fi sa\daily\gau\master.xlsx'

# Call the process_excel_file function with the file path
output_file = process_excel_file(file_path)

# Print the path of the generated output file
print("Output file generated:", output_file)

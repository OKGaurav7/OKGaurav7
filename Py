import pandas as pd

# Assuming output_df and Final_df are already defined

with pd.ExcelWriter(r'Z:\FI E-Sales\Daily Fails\Gaurav\output.xlsm', engine='openpyxl', mode='a') as writer:
    # Filter data where operation type is Buy
    buy_df = output_df[output_df['Operation Type'].str.contains('BUY')]
    buy_df.to_excel(writer, index=False, sheet_name='Buy Data', startrow=0, startcol=0)

    # Filter data where operation type is Sell
    sell_df = output_df[output_df['Operation Type'].str.contains('SELL')]
    sell_df.to_excel(writer, index=False, sheet_name='Sell Data', startrow=0, startcol=0)

    # Append output_df to 'Formatted All Data' sheet
    output_df.to_excel(writer, index=False, sheet_name='Formatted All Data', startrow=0, startcol=0)

    # Append Final_df to 'Raw Data' sheet
    Final_df.to_excel(writer, index=False, sheet_name='Raw Data', startrow=0, startcol=0)

import pandas as pd
from datetime import datetime
import random

# Read the master CSV file
master_df = pd.read_csv('master.csv')

# Select the specified columns
selected_columns = [
    'Counterparty Name',
    'Operation Type',
    'Trade Date',
    'Trade Price',
    'Value Date',
    'Primary Original Quantity',
    'Settlement Instrument Name',
    'ISIN Primary Instrument Reference',
    'Primary Instrument Long Name',
    'SMO Trade Reference',
    'Internal Status Narrative',
    'Sales Person Name'
]

# Create a new DataFrame with only the selected columns
output_df = master_df[selected_columns]

# Define new columns
new_columns = ['CBBT_PX_ASK', 'Economic Impact', 'LQA (Liq Score)', 'Days Elapsed']

# Insert new columns after "Trade Price"
output_df = output_df.reindex(columns=output_df.columns.tolist()[:4] + new_columns + output_df.columns.tolist()[4:])

# Add dummy data to new columns
output_df['CBBT_PX_ASK'] = [random.randint(1, 100) for _ in range(len(output_df))]
output_df['Economic Impact'] = [random.uniform(1000, 10000) for _ in range(len(output_df))]
output_df['LQA (Liq Score)'] = [random.uniform(1000, 10000) for _ in range(len(output_df))]
output_df['Days Elapsed'] = [random.randint(1, 30) for _ in range(len(output_df))]

# Convert 'Trade Date' and 'Value Date' to datetime format and then to string
output_df['Trade Date'] = pd.to_datetime(output_df['Trade Date']).dt.strftime('%Y-%m-%d')
output_df['Value Date'] = pd.to_datetime(output_df['Value Date']).dt.strftime('%Y-%m-%d')

# Calculate days elapsed
today = datetime.today()
output_df['Days Elapsed'] = (today - pd.to_datetime(output_df['Value Date'])).dt.days - 1

# Save the DataFrame to a CSV file
output_df.to_csv('output.csv', index=False)

# Add comment to the CSV file indicating red headers
with open('output.csv', 'r+') as f:
    content = f.read()
    f.seek(0, 0)
    f.write('# Please set headers in red color\n' + content)

from openpyxl import load_workbook
from openpyxl.utils import get_column_letter
from openpyxl.formula.translate import Translator

# Load the workbook
wb = load_workbook('output.xlsx')

# Select the sheet
ws = wb['All Data']

# Define the range for the VLOOKUP function
vlookup_range = '$E$105:$F$109'

# Loop through each row and set the formula for the "Economic Impact" column
for row in range(2, ws.max_row + 1):
    # Get the row number
    row_number = str(row)
    
    # Set the formula using the Translator function to handle cell references
    formula = f'=((-(E{row_number}-D{row_number}))/100)*J{row_number}*VLOOKUP(K{row_number},{vlookup_range},2,FALSE)'
    
    # Translate the formula to R1C1 notation
    translated_formula = Translator(formula, origin='A1', target='R1C1').translate_formula()
    
    # Set the formula in the cell
    ws[f'G{row_number}'].value = translated_formula

# Save the workbook
wb.save('output.xlsx')

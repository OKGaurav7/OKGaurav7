import os
import win32com.client
import zipfile

# Function to extract excel file from zip
def extract_excel_from_zip(zip_path, output_folder):
    with zipfile.ZipFile(zip_path, 'r') as zip_ref:
        for file in zip_ref.namelist():
            if file.endswith('.xlsx'):
                zip_ref.extract(file, output_folder)

# Function to check and process emails
def check_and_process_emails():
    outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")
    inbox = outlook.GetDefaultFolder(6)  # Inbox folder

    for message in inbox.Items:
        if "fear_file" in message.Subject.lower():
            for attachment in message.Attachments:
                if attachment.FileName.endswith('.zip'):
                    zip_path = os.path.join('C:\\path\\to\\save\\zip', attachment.FileName)
                    attachment.SaveAsFile(zip_path)
                    extract_excel_from_zip(zip_path, 'C:\\path\\to\\save\\extracted_files')
                    os.remove(zip_path)  # Remove the zip file after extraction

# Main function to run the script
def main():
    check_and_process_emails()

if __name__ == "__main__":
    main()

import win32com.client
import os
import zipfile

# Function to extract Excel file from zip and save it to a specified folder
def extract_excel_from_zip(zip_file_path, extract_folder):
    with zipfile.ZipFile(zip_file_path, 'r') as zip_ref:
        for file in zip_ref.namelist():
            if file.endswith('.xlsx'):
                zip_ref.extract(file, extract_folder)

# Connect to Outlook
outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")

# Specify the folder to check (Inbox in this case)
inbox = outlook.GetDefaultFolder(6)

# Get messages received in the last 15 minutes
messages = inbox.Items.Restrict("[ReceivedTime] >= '" + datetime.datetime.now() - datetime.timedelta(minutes=15) + "'")

# Loop through each message
for message in messages:
    # Check if subject contains "fear_file"
    if "fear_file" in message.Subject.lower():
        # Loop through attachments
        for attachment in message.Attachments:
            # Check if attachment is a zip file
            if attachment.FileName.endswith('.zip'):
                # Save zip file
                attachment.SaveAsFile(os.path.join("path_to_save_zip", attachment.FileName))
                # Extract Excel file from zip
                extract_excel_from_zip(os.path.join("path_to_save_zip", attachment.FileName), "path_to_save_excel")

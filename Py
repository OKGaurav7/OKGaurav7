import win32com.client

def apply_macros(source_file, target_file):
    xl = win32com.client.Dispatch("Excel.Application")
    xl.Visible = False  # Set to True if you want Excel to be visible during execution
    xl.DisplayAlerts = False  # Set to False to suppress any alerts

    try:
        # Open source file
        wb_source = xl.Workbooks.Open(Filename=source_file)

        # Open target file
        wb_target = xl.Workbooks.Open(Filename=target_file)

        # Access VBA project of source file and extract macro code
        vb_source = wb_source.VBProject
        module_source = vb_source.VBComponents("Module1")  # Adjust module name as needed
        macro_code = module_source.CodeModule.Lines(1, module_source.CodeModule.CountOfLines)

        # Access VBA project of target file and paste macro code
        vb_target = wb_target.VBProject
        module_target = vb_target.VBComponents("Module1")  # Adjust module name as needed
        module_target.CodeModule.AddFromString(macro_code)

        # Save and close target file
        wb_target.Save()
        wb_target.Close()

        # Close source file
        wb_source.Close()

    except Exception as e:
        print("An error occurred:", str(e))

    xl.Quit()

# Usage example
source_file = r'path\to\abc.xlsm'
target_file = r'path\to\output.xlsm'

apply_macros(source_file, target_file)



An error occurred: (-2147352567, 'Exception occurred.', (0, 'VBAProject', 'Subscript out of range', 'C:\\Program Files (x86)\\Common Files\\Microsoft Shared\\VBA\\VBA7.1\\1033\\VbLR6.chm', 1000009, -2146828279), None)

import pandas as pd

# Read the output.csv file into a DataFrame
output_df = pd.read_csv('output.csv')

# Convert 'Value Date' to datetime format
output_df['Value Date'] = pd.to_datetime(output_df['Value Date'])

# Extract unique counterparty names
unique_counterparties = output_df['Counterparty Name'].unique()

# Create a new DataFrame to store the aggregated data
new_columns = ['Counterparty Name', 'Vd', 'Vd+1', 'Vd+2', 'Vd+3', 'Vd+4', 'Vd+5', 'Vd+7', 'Vd>7', 'Total Fails', 'Overall Economic Impact']
new_excel_df = pd.DataFrame(columns=new_columns)

# Iterate over unique counterparty names
for counterparty in unique_counterparties:
    cp_data = output_df[output_df['Counterparty Name'] == counterparty]
    
    # Calculate values for each date range
    vd = len(cp_data)
    vd_plus_1 = len(cp_data[cp_data['Days Elapsed'] == 1])
    vd_plus_2 = len(cp_data[cp_data['Days Elapsed'] == 2])
    vd_plus_3 = len(cp_data[cp_data['Days Elapsed'] == 3])
    vd_plus_4 = len(cp_data[cp_data['Days Elapsed'] == 4])
    vd_plus_5 = len(cp_data[cp_data['Days Elapsed'] == 5])
    vd_plus_7 = len(cp_data[cp_data['Days Elapsed'] == 7])
    vd_gt_7 = len(cp_data[cp_data['Days Elapsed'] > 7])
    
    # Calculate total fails
    total_fails = vd_plus_1 + vd_plus_2 + vd_plus_3 + vd_plus_4 + vd_plus_5 + vd_plus_7 + vd_gt_7
    
    # Calculate overall economic impact
    overall_economic_impact = cp_data['Economic Impact'].sum()
    
    # Append data to the new DataFrame
    new_excel_df = new_excel_df.append({
        'Counterparty Name': counterparty,
        'Vd': vd,
        'Vd+1': vd_plus_1,
        'Vd+2': vd_plus_2,
        'Vd+3': vd_plus_3,
        'Vd+4': vd_plus_4,
        'Vd+5': vd_plus_5,
        'Vd+7': vd_plus_7,
        'Vd>7': vd_gt_7,
        'Total Fails': total_fails,
        'Overall Economic Impact': overall_economic_impact
    }, ignore_index=True)

# Save the new DataFrame to a new Excel file
new_excel_df.to_excel('new_excel.xlsx', index=False)

import win32com.client
import os
import zipfile
import datetime
import pytz

def extract_zip_attachment(mail_item, save_folder):
    attachments = mail_item.Attachments
    for attachment in attachments:
        if attachment.FileName.endswith('.zip'):
            zip_path = os.path.join(save_folder, attachment.FileName)
            attachment.SaveAsFile(zip_path)
            with zipfile.ZipFile(zip_path, 'r') as zip_ref:
                zip_ref.extractall(save_folder)
            os.remove(zip_path)

def check_mail_inbox(subject_keyword, save_folder):
    outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")
    inbox = outlook.GetDefaultFolder(6)  # 6 refers to the Inbox folder
    messages = inbox.Items
    messages.Sort("[ReceivedTime]", True)
    current_time = datetime.datetime.now(pytz.utc)
    fifteen_minutes_ago = current_time - datetime.timedelta(minutes=15)
    for message in messages:
        received_time = message.ReceivedTime.replace(tzinfo=pytz.utc)
        if subject_keyword.lower() in message.Subject.lower() and received_time >= fifteen_minutes_ago:
            extract_zip_attachment(message, save_folder)

if __name__ == "__main__":
    subject_keyword = "fear_file"
    save_folder = r"C:\path\to\save\folder"
    check_mail_inbox(subject_keyword, save_folder)

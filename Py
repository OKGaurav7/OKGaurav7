import win32com.client
import os
import zipfile
import datetime

def extract_zip_attachment(mail_item, save_folder):
    attachments = mail_item.Attachments
    for attachment in attachments:
        if attachment.FileName.endswith('.zip'):
            zip_path = os.path.join(save_folder, attachment.FileName)
            attachment.SaveAsFile(zip_path)
            with zipfile.ZipFile(zip_path, 'r') as zip_ref:
                zip_ref.extractall(save_folder)
            os.remove(zip_path)

def check_mail_inbox(subject_keyword, save_folder):
    try:
        outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")
        inbox = outlook.GetDefaultFolder(6)  # 6 refers to the Inbox folder
        messages = inbox.Items
        messages.Sort("[ReceivedTime]", True)
        today = datetime.date.today()
        for message in messages:
            if subject_keyword.lower() in message.Subject.lower():
                received_date = message.ReceivedTime.date()
                if received_date == today:
                    extract_zip_attachment(message, save_folder)
    except Exception as e:
        print("An error occurred while accessing Outlook:", e)

if __name__ == "__main__":
    subject_keyword = "fear_file"
    save_folder = r"C:\path\to\save\folder"
    check_mail_inbox(subject_keyword, save_folder)

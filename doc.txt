import pandas as pd
from itertools import permutations

# Read the CSV file
df = pd.read_csv("your_file.csv")

# Create a new DataFrame to store the output
output_df = pd.DataFrame(columns=df.columns)

# Iterate over each unique combination of 'cNameEMA_x' and 'primaryProduct_x'
for index, group in df.groupby(['cNameEMA_x', 'primaryProduct_x']):
    # Get unique country codes for this group
    country_codes = group['countryCode'].unique()

    # Generate permutations of sorted country codes
    for perm in permutations(sorted(country_codes)):
        # Create a new row with the current permutation
        new_row = group.iloc[0].copy()
        new_row['countryCode'] = ', '.join(perm)
        output_df = pd.concat([output_df, pd.DataFrame([new_row])], ignore_index=True)

# Append the original DataFrame to the output DataFrame
output_df = pd.concat([output_df, df], ignore_index=True)

# Save the output to a new CSV file
output_df.to_csv("output.csv", index=False)

import pandas as pd
from itertools import combinations

# Read the CSV file
df = pd.read_csv("Gap Metrics.csv")

# Create a new DataFrame to store the output
output_df = pd.DataFrame(columns=df.columns)

# Define aggregation functions for each column
agg_funcs = {'countryCode': lambda x: ', '.join(x.unique()),  # Join unique country codes
             'other_column1': 'sum',  # Aggregate other columns as needed
             'other_column2': 'mean',  # For example, sum, mean, etc.
             'other_column3': 'max'}

# Iterate over each unique combination of 'cNameEMA_x' and 'primaryProduct_x'
for index, group in df.groupby(['cNameEMA_x', 'primaryProduct_x']):
    # Aggregate values of other columns for this group
    aggregated_values = group.drop(['cNameEMA_x', 'primaryProduct_x'], axis=1).agg(agg_funcs)
    
    # Create a new row with the aggregated values and the current combination
    new_row = pd.Series(index=df.columns)
    new_row.update(aggregated_values)
    output_df = output_df.append(new_row, ignore_index=True)

# Append the original DataFrame to the output DataFrame
output_df = pd.concat([output_df, df], ignore_index=True)

# Save the output to a new CSV file
output_df.to_csv("output.csv", index=False)

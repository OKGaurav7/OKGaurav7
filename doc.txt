import pandas as pd
from itertools import combinations

# Read the CSV file
df = pd.read_csv("Gap Metrics.csv")

# Create a new DataFrame to store the output
output_df = pd.DataFrame(columns=df.columns)

# Iterate over each unique combination of 'cNameEMA_x' and 'primaryProduct_x'
for index, group in df.groupby(['cNameEMA_x', 'primaryProduct_x']):
    # Get unique country codes for this group
    country_codes = group['countryCode'].unique()

    # Generate combinations of country codes
    for r in range(1, len(country_codes) + 1):
        for comb in combinations(country_codes, r):
            # Check if any of the country codes in the combination already exist in the original DataFrame
            if not any(code in ','.join(country_codes) for code in comb):
                # Create a new row with the current combination
                new_row = group.iloc[0].copy()
                new_row['countryCode'] = ', '.join(comb)
                output_df = pd.concat([output_df, pd.DataFrame([new_row])], ignore_index=True)

# Append the original DataFrame to the output DataFrame
output_df = pd.concat([output_df, df], ignore_index=True)

# Save the output to a new CSV file
output_df.to_csv("output.csv", index=False)
